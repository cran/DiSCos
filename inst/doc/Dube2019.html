<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David Van Dijcke" />

<meta name="date" content="2024-07-22" />

<title>Empirical Application in Gunsilius (2023)</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>






<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Empirical Application in Gunsilius
(2023)</h1>
<h4 class="author">David Van Dijcke</h4>
<h4 class="date">2024-07-22</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette demonstrates how to use the DiSCo package by way of the
empirical application in <span class="citation">Gunsilius (2023)</span>,
which is based on <span class="citation">Dube (2019)</span>. We
illustrate the use of the two main functions: 1) <code>DiSCo</code>,
which estimates the raw distributional counterfactuals, computes
confidence intervals, and optionally performs a permutation test; and 2)
<code>DiSCoTEA</code>, the “Treatment Effect Aggregator”, which takes in
the distributional counterfactuals and computes aggregate treatment
effects using a user-specified aggregation statistic.</p>
</div>
<div id="distributional-synthetic-controls" class="section level1">
<h1>Distributional Synthetic Controls</h1>
<p>We briefly review the main idea behind Distributional Synthetic
Controls. Denote <span class="math inline">\(Y_{jt,N}\)</span> the
outcome of group <span class="math inline">\(j\)</span> in time period
<span class="math inline">\(t\)</span> in the absence of an
intervention. Also denote <span class="math inline">\(Y_{jt,I}\)</span>
the outcome in the presence of an intervention at time <span class="math inline">\(t &gt; T_0\)</span>. Denote the quantile function,
<span class="math display">\[
F^{-1}(q):=\inf _{y \in \mathbb{R}}\{F(y) \geq q\}, \quad q \in(0,1),
\]</span> where <span class="math inline">\(F(y)\)</span> is the
corresponding cumulative distribution function. One unit <span class="math inline">\(j=1\)</span> has received treatment, while the
other units <span class="math inline">\(j=2,\ldots,J\)</span> have not.
Then the goal is to estimate the counterfactual quantile function <span class="math inline">\(F_{Y_{1 t}, N}^{-1}\)</span> of the treated unit
had it not received treatment by an optimally weighted average of the
control units’ quantile functions, <span class="math display">\[
F_{Y_{1 t}, N}^{-1}(q)=\sum_{j=2}^{J+1} \lambda_j^* F_{Y_{j t}}^{-1}(q)
\quad \text { for all } q \in(0,1)
\]</span><br />
In practice, we do this by solving the following optimization problem:
<span class="math display">\[
\vec{\lambda}_t^*=\underset{\vec{\lambda} \in
\Delta^J}{\operatorname{argmin}} \int_0^1\left|\sum_{j=2}^{J+1}
\lambda_j F_{Y_{j t}}^{-1}(q)-F_{Y_{1 t}}^{-1}(q)\right|^2 d q
\]</span>which gives an optimal weight for each unit-period combination.
This problem can be solved by a simple weighted regression, which is
implemented in the <code>DiSCo_weights_reg</code> function. To obtain
the overall optimal weights <span class="math inline">\(\vec{\lambda}^*\)</span>, we take the average of
the optimal weights across all periods.</p>
</div>
<div id="basic-usage" class="section level1">
<h1>Basic Usage</h1>
<p>To get coding, we load the data from <span class="citation">Dube
(2019)</span>, which is available in the package.</p>
<p>To learn more about the data, just type <code>?dube</code> in the
console. We have already renamed the outcome, id, and time variables to
<code>y_col</code>, <code>id_col</code>, and <code>time_col</code>,
respectively, which is required before passing the dataframe to the
DiSCo command. We also need to set the two following parameters:</p>
<p>which indicate the id of the treated unit and the time period of the
intervention, respectively. We can now run the DiSCo command:</p>
<p>where we have chosen a grid (<code>G</code>) of 1000 quantiles and
opted for parallel computation with 5 cores to speed up the permutation
test and confidence intervals (<code>CI</code> is set to
<code>TRUE</code>), which we calculate using 1000 resamples
(<code>boots</code>). We also set the <code>seed</code> explicitly in
the function call, which ensures reproducibility across the parallel
cores. We followed the “classical” approach of <span class="citation">Abadie, Diamond, and Hainmueller (2010)</span> by
restricting the weights to be between 0 and 1
(<code>simplex=TRUE</code>). Finally, we restricted the data to the
0-90th quantile to account for the fact that the CPS data used in <span class="citation">Dube (2019)</span> is imputed for the top income
quantiles (more detail in the section below).</p>
<p>The returned <code>disco</code> object contains a host of information
produced by the command. Typing <code>?DiSCoT</code> in the console
pulls up the help files which lay out the precise structure of the
returned object. For now, we will just have a look at the top 10
estimated weights,</p>
<p>When we ran the <code>DiSCo</code> command, we set
<code>permutation</code> to <code>TRUE</code>, which runs the
permutation test described in the paper (see <code>?DiSCo_per</code> for
more details). This will allow us to inspect the permutation inference
results below. Already, by setting <code>graph</code> to
<code>TRUE</code>, the function displayed a plot of the full
distribution of permutation tests. The black solid line shows the fit of
the “true” synthetic control. The fact that it does not diverge stronger
than the other lines in gray after treatment suggests that the treatment
had no effect.</p>
<p>For context, the y-axis is the squared Wasserstein distance between
the counterfactual and observed quantile functions, <span class="math display">\[
d_{t t}^2:=\int_0^1\left|F_{Y_{u t, N}}^{-1}(q)-F_{Y_{u
t}}^{-1}(q)\right|^2 d q
\]</span>and, as in <span class="citation">Abadie, Diamond, and
Hainmueller (2010)</span> we take the ratio of post- to pre-intervention
Wasserstein distance to account for variation in the pre-treatment fit
across placebo tests, <span class="math display">\[
r_j=\frac{R_j\left(T_0+1, T\right)}{R_j\left(1, T_0\right)}
\]</span> and calculate the p-value for the permutation test as, <span class="math display">\[
p=\frac{1}{J+1} \sum_{j=1}^{J+1} H\left(r_j-r_1\right),
\]</span>where <span class="math inline">\(H(x)\)</span> is the
Heaviside function which is 1 if <span class="math inline">\(x\geq
0\)</span> and 0 otherwise. This p-value gives the probability of
observing a placebo test with a larger ratio than the true treatment
effect. It can be retrieved by calling</p>
<p>The p-value is larger than 0.05, which confirms the visual result
from the plot above, while accounting for potential differences in
pre-treatment fit across placebo units.</p>
<p>Finally, we can use the DiSCo Treatment Effect Aggregator
(<code>DiSCoTEA</code>) function to aggregate the resulting
counterfactual quantile functions into various treatment effect
measures. For example, we can calculate the difference between the
counterfactual and observed quantile functions and cumulative
distribution functions (CDF) as follows.</p>
<p>Calling <code>summary</code> on the returned object prints a table
summarizing the effects across the distribution. You can choose the
intervals of quantiles over which it aggregates using the
<code>samples</code> parameter. If you calculated the permutation test
and confidence intervals in the <code>DiSCo</code> function, these are
reported as well.</p>
<p>Setting <code>graph</code> to <code>TRUE</code> also prints a plot of
the distribution differences over time You can focus on specific years
using the <code>t_plot</code> parameter. You can use the other
parameters of the <code>DiSCOTEA</code> function to adjust the basic
appearance of the plots, or directly alter the ggplot object that is
stored in the returned <code>DiSCoT</code> object.</p>
<p>Looking at the plot of the quantile and CDF differences, we can see
two things: 1) the pre-treatment fit for the years 1998-2002 is decent
but not perfect; 2) there do not appear to be any notable effects of the
minimum wage inrease, asides from fluctuations in the function
differences that are similar to those pre-treatment.</p>
</div>
<div id="robustness-tests" class="section level1">
<h1>Robustness tests</h1>
<p>The package offers various ways to further test suspected effects.
For example, we can focus on a specific part of the distribution, and
construct a separate synthetic control for it. Mathematically, this
comes down to,</p>
<p><span class="math display">\[
\vec{\lambda}_t^*=\underset{\vec{\lambda} \in
\Delta^J}{\operatorname{argmin}}
\int_{\text{q_min}}^{\text{q_max}}\left|\sum_{j=2}^{J+1} \lambda_j
F_{Y_{j t}}^{-1}(q)-F_{Y_{1 t}}^{-1}(q)\right|^2 d q,
\]</span></p>
<p>where <span class="math inline">\(\text{q_min} &lt;
\text{q_max}\)</span> are the bounds of the quantile range we’re
interested in. For example, following <span class="citation">Dube
(2019)</span>, we can focus on the lower end of the distribution, up
until observations that earn 3.5 times the poverty income threshold.
This corresponds to around the 0.65th quantile in our data:</p>
<p>We can simply run the following code,</p>
<p>One could also try to deal with irregularity in the estimated
quantile functions is by using the <code>qmethod</code> option in the
<code>DiSCo</code> command, which allows for the use of alternative
quantile estimation methods that can account for non-smoothness and
extreme values. As above, we plot the results using the
<code>DiScoTEA</code> function:</p>
<p>Again, we do not observe any subtantial changes in the quantile
functions or CDFs. Also, the p-value of the permutation test is now
larger, losing the marginal significance it had before. Overall, we
cannot reject the null hypothesis of there being no effect of the
treatment.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>In this vignette, we have demonstrated the DiSCo package using the
data from the empirical application in <span class="citation">Gunsilius
(2023)</span>. We estimated the difference in between the quantile
functions of the distributional synthetic control constructed with the
<code>DiSco</code> command and the observed quantile function. To test
for the presence of treatment effects, we inspected the pre-treatment
distributional fit, carried out a permutation test, and re-estimated the
synthetic control for a restricted quantile range; all these robustness
tests are available in the DiSCo package, together with handy graphing
and aggregation tools.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-abadie2010synthetic" class="csl-entry">
Abadie, Alberto, Alexis Diamond, and Jens Hainmueller. 2010.
<span>“Synthetic Control Methods for Comparative Case Studies:
Estimating the Effect of California’s Tobacco Control Program.”</span>
<em>Journal of the American Statistical Association</em> 105 (490):
493–505.
</div>
<div id="ref-dube2019minimum" class="csl-entry">
Dube, Arindrajit. 2019. <span>“Minimum Wages and the Distribution of
Family Incomes.”</span> <em>American Economic Journal: Applied
Economics</em> 11 (4): 268–304.
</div>
<div id="ref-gunsilius2023distributional" class="csl-entry">
Gunsilius, Florian F. 2023. <span>“Distributional Synthetic
Controls.”</span> <em>Econometrica</em> 91 (3): 1105–17.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
